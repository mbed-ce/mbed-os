<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mbed OS Reference: USB Device Core</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="mbed-ce_55x55.png"/></td>
  <td id="projectalign">
   <div id="projectname">Mbed OS Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__usb__device__core.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a>  </div>
  <div class="headertitle"><div class="title">USB Device Core</div></div>
</div><!--header-->
<div class="contents">

<p>Abstract interface to physical USB hardware.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_u_s_b_phy_events.html">USBPhyEvents</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Event handler for <a class="el" href="class_u_s_b_phy.html">USBPhy</a>.  <a href="class_u_s_b_phy_events.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Abstract interface to physical USB hardware. </p>
<h1><a class="anchor" id="autotoc_md62"></a>
Defined behavior</h1>
<ul>
<li>You can use any endpoint configurations that fit in the parameters of the table returned by <a class="el" href="class_u_s_b_phy.html#a2d7bb2640b5965b8f6d67707ee31ec43" title="Get the endpoint table.">USBPhy::endpoint_table</a>.</li>
<li>You can use all endpoints in any valid endpoint configuration concurrently.</li>
<li>The device supports use of at least one control, bulk, interrupt and isochronous in each direction at the same time - at least 8 endpoints.</li>
<li><a class="el" href="class_u_s_b_phy.html">USBPhy</a> supports all standard endpoint sizes (wMaxPacketSize).</li>
<li><a class="el" href="class_u_s_b_phy.html">USBPhy</a> can handle an interrupt latency of at least 100ms if the host PC is not performing a reset or setting the device's address.</li>
<li><a class="el" href="class_u_s_b_phy.html">USBPhy</a> only sends <a class="el" href="class_u_s_b_phy_events.html" title="Event handler for USBPhy.">USBPhyEvents</a> when it is in the initialized state.</li>
<li>When unpowered, <a class="el" href="class_u_s_b_phy.html">USBPhy</a> only sends the <a class="el" href="class_u_s_b_phy_events.html#a0e153d20beec9b7e5bc8314d6fcc765d" title="Callback called USB power is applied or removed.">USBPhyEvents::power</a> event.</li>
<li>On USB reset, all endpoints are removed except for endpoint 0.</li>
<li>A call to <a class="el" href="class_u_s_b_phy.html#af036c42fa5434f5881b704ee09a9ed65" title="Write a packet on endpoint 0.">USBPhy::ep0_write</a> results in the call of <a class="el" href="class_u_s_b_phy_events.html#abccfc5d4ae87ca7c59e498adc5626a3e" title="Callback called on the transmission of an IN packet.">USBPhyEvents::in</a> when the PC reads the data unless a power loss, reset, or a call to <a class="el" href="class_u_s_b_phy.html#ac4b9cc415683acddaa6545ffb693fb23" title="Detach the USB phy.">USBPhy::disconnect</a> occurs first.</li>
<li>A call to <a class="el" href="class_u_s_b_phy.html#a8a5825552cdaa64b8916b626ca9e546e" title="Start a write on the given endpoint.">USBPhy::endpoint_write</a> results in the call of <a class="el" href="class_u_s_b_phy_events.html#abccfc5d4ae87ca7c59e498adc5626a3e" title="Callback called on the transmission of an IN packet.">USBPhyEvents::in</a> when the pc reads the data unless a power loss, reset, or a call to <a class="el" href="class_u_s_b_phy.html#ae551659076ba4ae394bc5d602ca00dc8" title="Abort the current transfer if it has not yet been sent.">USBPhy::endpoint_abort</a> occurs first.</li>
<li>A call to <a class="el" href="class_u_s_b_phy.html#a1e04a43787520f019444c299454a0021" title="Start a read on the given endpoint.">USBPhy::endpoint_read</a> results in the call of <a class="el" href="class_u_s_b_phy_events.html#a13a457fcd37db7e17f97501d9200a5db" title="Callback called on the reception of an OUT packet.">USBPhyEvents::out</a> when the pc sends data unless a power loss, reset, or a call to <a class="el" href="class_u_s_b_phy.html#ae551659076ba4ae394bc5d602ca00dc8" title="Abort the current transfer if it has not yet been sent.">USBPhy::endpoint_abort</a> occurs first.</li>
<li>Endpoint 0 naks all transactions aside from setup packets until higher-level code calls one of <a class="el" href="class_u_s_b_phy.html#afab7b1ac8b0aded8a16ed9b2e06a44b7" title="Start receiving a packet of up to wMaxPacketSize on endpoint 0.">USBPhy::ep0_read</a>, <a class="el" href="class_u_s_b_phy.html#af036c42fa5434f5881b704ee09a9ed65" title="Write a packet on endpoint 0.">USBPhy::ep0_write</a> or <a class="el" href="class_u_s_b_phy.html#aa368765be668dc5d21f3c190b38c34f3" title="Protocol stall on endpoint 0.">USBPhy::ep0_stall</a>.</li>
<li>Endpoint 0 stall automatically clears on reception of a setup packet.</li>
</ul>
<h1><a class="anchor" id="autotoc_md63"></a>
Undefined behavior</h1>
<ul>
<li>Calling <a class="el" href="class_u_s_b_phy.html#ac70515099d7d499ef2756f9c5668ef46" title="Configure and enable an endpoint.">USBPhy::endpoint_add</a> or <a class="el" href="class_u_s_b_phy.html#a2df969814bbc2e391ddc318a10a1e1ff" title="Disable an endpoint.">USBPhy::endpoint_remove</a> outside of the control requests SetInterface or SetConfiguration.</li>
<li>Calling <a class="el" href="class_u_s_b_phy.html#a2df969814bbc2e391ddc318a10a1e1ff" title="Disable an endpoint.">USBPhy::endpoint_remove</a> on an endpoint that has an ongoing read or write operation. To avoid undefined behavior, you must abort ongoing operations with <a class="el" href="class_u_s_b_phy.html#ae551659076ba4ae394bc5d602ca00dc8" title="Abort the current transfer if it has not yet been sent.">USBPhy::endpoint_abort</a>.</li>
<li>Devices behavior is undefined if latency is greater than 2ms when address is being set - see USB spec 9.2.6.3.</li>
<li>Devices behavior is undefined if latency is greater than 10ms when a reset occurs - see USB spec 7.1.7.5.</li>
<li>Calling any of the USBPhy::endpoint_* functions on endpoint 0.</li>
</ul>
<h1><a class="anchor" id="autotoc_md64"></a>
Notes</h1>
<ul>
<li>Make sure <a class="el" href="class_u_s_b_phy.html">USBPhy</a> sends <a class="el" href="class_u_s_b_phy_events.html" title="Event handler for USBPhy.">USBPhyEvents</a> in the correct order when multiple packets are present. <a class="el" href="class_u_s_b_phy.html">USBPhy</a> must send IN endpoint events before OUT endpoint events if both are pending.</li>
<li>A host PC may resend setup packets to a USB device if there is noise on the USB line. The <a class="el" href="class_u_s_b_phy.html">USBPhy</a> should be able to handle this scenario and respond to the setup packet with an ACK.</li>
<li>Bidirectional protocols making use of alternating IN and OUT phases should not rely on the last ACK an IN transfer to indicate that the OUT phase should start. Instead, the OUT phase should be started at the same time the last IN transfer is started. This is because the ACK to the last in transfer may be dropped if there is noise on the USB line. If dropped, it will only be resent on the next IN phase. You can find more information on this in section 8.5.3.3 of the USB specification. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
